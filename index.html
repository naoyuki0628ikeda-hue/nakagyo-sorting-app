<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>中京区仕分け用アプリ</title>
  <style>
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background-color:#ffffff;
      background-image:
        linear-gradient(#e9e9e9 1px, transparent 1px),
        linear-gradient(90deg, #e9e9e9 1px, transparent 1px);
      background-size: 26px 26px, 26px 26px;
      color:#111;
    }
    .sheet{
      max-width: 520px;
      margin: 0 auto;
      padding: 18px 14px 28px;
    }
    .title{
      text-align:center;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .06em;
      margin: 6px 0 18px;
    }
    .label{
      font-size: 16px;
      font-weight: 700;
      margin: 10px 0 8px;
    }
    .box{
      border: 2px solid #000;
      background: rgba(255,255,255,.65);
      border-radius: 2px;
      height: 78px;
      display:flex;
      align-items:center;
      padding: 10px 12px;
      box-sizing:border-box;
    }
    .box.big{ height: 110px; }
    input.zip{
      width: 100%;
      font-size: 34px;
      font-weight: 700;
      letter-spacing: .18em;
      border: none;
      outline: none;
      background: transparent;
    }
    input.zip::placeholder{
      color:#9a9a9a;
      letter-spacing: .05em;
      font-weight: 600;
      font-size: 18px;
    }
    .subnote{
      margin: 10px 0 0;
      font-size: 14px;
      color:#222;
    }
    .addressLine{
      margin: 14px 0 4px;
      font-size: 14px;
      color:#111;
    }
    .addressLine span{
      font-weight: 700;
    }
    .resultCode{
      font-size: 42px;
      font-weight: 800;
      letter-spacing: .14em;
      user-select: none;
    }
    .muted{
      font-size: 13px;
      color:#333;
      margin-top: 6px;
      line-height: 1.4;
    }
    .warn{
      color:#b00020;
      font-size: 14px;
      font-weight: 700;
    }
    .list{
      width:100%;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .choice{
      border: 1px solid #000;
      background: rgba(255,255,255,.75);
      padding: 10px 10px;
      cursor: pointer;
    }
    .choice:active{ transform: translateY(1px); }
    .choice .c{
      font-size: 26px;
      font-weight: 800;
      letter-spacing: .10em;
    }
    .choice .a{
      font-size: 13px;
      margin-top: 6px;
      line-height: 1.35;
    }
    .footerHint{
      margin-top: 14px;
      font-size: 12px;
      color:#333;
      line-height: 1.5;
    }
    .btnRow{
      margin-top: 10px;
      display:flex;
      gap:10px;
    }
    button{
      border: 1px solid #000;
      background:#fff;
      padding: 10px 12px;
      font-size: 14px;
      cursor:pointer;
    }
    button:active{ transform: translateY(1px); }
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      padding: 10px 12px;
      border: 1px solid #000;
      background: rgba(255,255,255,.95);
      font-size: 13px;
      max-width: 92vw;
      text-align:center;
      opacity:0;
      transition: opacity .15s ease;
      pointer-events:none;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div class="sheet">
    <div class="title">中京区仕分け用アプリ</div>

    <div class="label">郵便番号入力</div>
    <div class="box">
      <input id="zip5" class="zip" type="tel" inputmode="numeric" autocomplete="off" maxlength="5" placeholder="下5ケタ（例 48092）" />
    </div>

    <div class="btnRow">
      <button id="clearBtn" type="button">クリア</button>
      <button id="pasteBtn" type="button">貼り付け</button>
    </div>

    <div class="subnote">※ 数字以外は自動で消えます。5桁そろうと自動検索します。</div>

    <div class="addressLine">（住所） <span id="addressText">-</span></div>

    <div class="label">仕分けコード</div>
    <div id="resultBox" class="box big">
      <div id="resultInner" class="muted">郵便番号下5ケタを入力してください</div>
    </div>

    <div class="footerHint">
      ・同じ下5ケタが複数候補の場合は、候補をタップして選択できます。<br/>
      ・仕分けコードはタップでコピーできます。
    </div>
  </div>

  <div id="toast" class="toast"></div>

<script>
let DB = null;

function onlyDigits(s){ return (s || "").replace(/\D/g, ""); }

async function loadDB(){
  const res = await fetch("./data.json", { cache: "no-store" });
  DB = await res.json();
}

function setAddress(text){
  document.getElementById("addressText").textContent = text || "-";
}

function setResultContent(node){
  const inner = document.getElementById("resultInner");
  inner.replaceWith(node);
  node.id = "resultInner";
}

function toast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.opacity = "1";
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=>{ t.style.opacity = "0"; }, 1400);
}

async function copyText(text){
  try{
    await navigator.clipboard.writeText(text);
    toast("コピーしました: " + text);
  }catch(e){
    const ta = document.createElement("textarea");
    ta.value = text;
    ta.style.position="fixed";
    ta.style.left="-9999px";
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    toast("コピーしました: " + text);
  }
}

function renderDefault(){
  setAddress("-");
  const d = document.createElement("div");
  d.className = "muted";
  d.textContent = "郵便番号下5ケタを入力してください";
  setResultContent(d);
}

function renderNotFound(zip5){
  setAddress("-");
  const d = document.createElement("div");
  d.className = "warn";
  d.textContent = "該当なし（" + zip5 + "）";
  setResultContent(d);
}

function renderSingle(entry){
  setAddress(entry.address || "-");

  const d = document.createElement("div");
  d.style.width = "100%";

  const code = document.createElement("div");
  code.className = "resultCode";
  code.textContent = entry.code;

  const m = document.createElement("div");
  m.className = "muted";
  m.textContent = "（タップでコピー）";

  d.appendChild(code);
  d.appendChild(m);

  d.addEventListener("click", ()=>copyText(entry.code));
  setResultContent(d);
}

function renderMulti(entries){
  setAddress("候補を選択してください");

  const wrap = document.createElement("div");
  wrap.className = "list";

  for (const e of entries){
    const c = document.createElement("div");
    c.className = "choice";

    const code = document.createElement("div");
    code.className = "c";
    code.textContent = e.code;

    const addr = document.createElement("div");
    addr.className = "a";
    addr.textContent = e.address;

    c.appendChild(code);
    c.appendChild(addr);

    c.addEventListener("click", ()=>{
      renderSingle(e);
    });

    wrap.appendChild(c);
  }

  setResultContent(wrap);
}

function searchAndRender(zip5){
  if (!DB) return;
  if (zip5.length !== 5) return renderDefault();

  const entries = DB[zip5];
  if (!entries) return renderNotFound(zip5);

  if (entries.length === 1) return renderSingle(entries[0]);
  return renderMulti(entries);
}

(async function main(){
  await loadDB();

  const inp = document.getElementById("zip5");
  const clearBtn = document.getElementById("clearBtn");
  const pasteBtn = document.getElementById("pasteBtn");

  inp.addEventListener("input", ()=>{
    const cleaned = onlyDigits(inp.value).slice(0,5);
    if (inp.value !== cleaned) inp.value = cleaned;
    if (cleaned.length === 5) searchAndRender(cleaned);
    else renderDefault();
  });

  clearBtn.addEventListener("click", ()=>{
    inp.value = "";
    inp.focus();
    renderDefault();
  });

  pasteBtn.addEventListener("click", async ()=>{
    try{
      const t = await navigator.clipboard.readText();
      const cleaned = onlyDigits(t).slice(0,5);
      inp.value = cleaned;
      if (cleaned.length === 5) searchAndRender(cleaned);
      else renderDefault();
    }catch(e){
      toast("貼り付けができません（ブラウザ設定の可能性）");
    }
  });

  renderDefault();
  inp.focus();
})();
</script>
</body>
</html>